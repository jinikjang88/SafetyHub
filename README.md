# SafetyHub - 통합 안전 관제 플랫폼

> "기계도 사람도, 위험 순간에 즉시 반응하는 안전 시스템"

---

## 📋 Executive Summary

SafetyHub는 **산업 설비**와 **작업자**를 동시에 모니터링하고, 위험 상황 발생 시 **즉각적인 대응**을 자동화하는 통합 안전 관제 플랫폼입니다.

### 핵심 가치

| 문제 | 기존 방식 | SafetyHub 솔루션 |
|------|----------|-----------------|
| 노후 설비 안전 | 전체 교체 (수십억) | 레트로핏 장치 추가 (수백만) |
| 작업자 응급상황 | 발견까지 시간 소요 | 실시간 감지 + 자동 신고 |
| 시스템 통합 | 설비/인력 별도 관리 | 단일 플랫폼 통합 관제 |

---

## 🏗️ 시스템 아키텍처

### 전체 구성도

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           SafetyHub Platform                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                   │
│  │   SafetyKit │     │  LifeGuard  │     │   Robot     │                   │
│  │   (설비용)   │     │   (작업자)   │     │  Simulator  │                   │
│  └──────┬──────┘     └──────┬──────┘     └──────┬──────┘                   │
│         │                   │                   │                           │
│         └───────────────────┼───────────────────┘                           │
│                             │                                                │
│                             ▼                                                │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                      Unified Safety Gateway                           │  │
│  │                                                                        │  │
│  │   ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐            │  │
│  │   │   MQTT   │  │WebSocket │  │   REST   │  │   gRPC   │            │  │
│  │   │ Adapter  │  │ Adapter  │  │ Adapter  │  │ Adapter  │            │  │
│  │   └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘            │  │
│  │        └─────────────┴─────────────┴─────────────┘                   │  │
│  │                             │                                         │  │
│  │                             ▼                                         │  │
│  │                    ┌─────────────────┐                                │  │
│  │                    │   Port Layer    │  ← 프로토콜 무관 인터페이스      │  │
│  │                    └────────┬────────┘                                │  │
│  └─────────────────────────────┼────────────────────────────────────────┘  │
│                                │                                            │
│  ┌─────────────────────────────┼────────────────────────────────────────┐  │
│  │                      Core Domain Layer                                │  │
│  │                                                                        │  │
│  │   ┌────────────────────────────────────────────────────────────┐     │  │
│  │   │                   Event Processing                         │     │  │
│  │   │                                                            │     │  │
│  │   │  🔴 Hot Path     🟡 Warm Path      🔵 Cold Path            │     │  │
│  │   │   (< 10ms)        (< 500ms)         (Async)               │     │  │
│  │   │                                                            │     │  │
│  │   │  • 긴급 정지      • 태스크 분배     • 로그 저장             │     │  │
│  │   │  • 충돌 회피      • 경로 계산       • 통계 분석             │     │  │
│  │   │  • 119 신고       • 알림 발송       • 리포팅               │     │  │
│  │   └────────────────────────────────────────────────────────────┘     │  │
│  │                                                                        │  │
│  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                  │  │
│  │   │   Device    │  │   Worker    │  │    Task     │   Domain         │  │
│  │   │   Entity    │  │   Entity    │  │   Entity    │   Entities       │  │
│  │   └─────────────┘  └─────────────┘  └─────────────┘                  │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                │                                            │
│  ┌─────────────────────────────┼────────────────────────────────────────┐  │
│  │                    Infrastructure Layer                               │  │
│  │                                                                        │  │
│  │   ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐            │  │
│  │   │  MySQL   │  │  Redis   │  │  Kafka   │  │  HiveMQ  │            │  │
│  │   │   (DB)   │  │ (Cache)  │  │ (Event)  │  │  (MQTT)  │            │  │
│  │   └──────────┘  └──────────┘  └──────────┘  └──────────┘            │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 클린 아키텍처 원칙

```
                    ┌─────────────────────────────────┐
                    │         Frameworks &            │
                    │           Drivers               │
                    │  (MQTT, REST, DB, Kafka, etc.)  │
                    └───────────────┬─────────────────┘
                                    │
                    ┌───────────────▼─────────────────┐
                    │      Interface Adapters         │
                    │   (Controllers, Gateways,       │
                    │    Presenters, Repositories)    │
                    └───────────────┬─────────────────┘
                                    │
                    ┌───────────────▼─────────────────┐
                    │      Application Business       │
                    │           Rules                 │
                    │        (Use Cases)              │
                    └───────────────┬─────────────────┘
                                    │
                    ┌───────────────▼─────────────────┐
                    │      Enterprise Business        │
                    │           Rules                 │
                    │   (Entities, Domain Events)     │
                    └─────────────────────────────────┘
                    
    의존성 방향: 바깥 → 안쪽 (내부 레이어는 외부를 모름)
```

### 뇌-신경계 아키텍처 비유

인간의 신경계처럼 상황의 긴급도에 따라 다른 경로로 처리합니다.

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Human Neural System                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   🔥 척수 반사 (Reflex)      🧠 대뇌 (Thinking)       📚 기억 (Memory)   │
│   ─────────────────────     ─────────────────       ─────────────────   │
│   • 뜨거우면 손 뗀다         • 판단, 계획            • 경험 저장          │
│   • 생각 안 함              • 시간 걸림              • 나중에 참조        │
│   • 1ms 이내               • 100ms~수초             • 느려도 됨         │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓↓↓
┌─────────────────────────────────────────────────────────────────────────┐
│                        SafetyHub System                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   🔴 Hot Path (반사)        🟡 Warm Path (판단)      🔵 Cold Path (기록) │
│   ─────────────────────     ─────────────────       ─────────────────   │
│   • 긴급 정지               • 태스크 분배            • 로그 저장          │
│   • 충돌 회피               • 경로 계산              • 통계 분석          │
│   • 119 자동 신고           • 스케줄링               • 리포팅            │
│                                                                          │
│   In-Memory Only           Service + DB             Kafka + Batch       │
│   < 10ms                   < 500ms                  비동기              │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📦 제품 라인업

### 1. SafetyKit (산업 설비용 안전 장치)

기존 설비를 교체하지 않고 **전원선에 끼워넣는 방식**으로 안전 시스템을 추가합니다.

#### 개념

```
기존 연결:
──────────
    콘센트 ────────────────────→ 설비장비


SafetyKit 적용:
───────────────
    콘센트 ────→ [SafetyKit] ────→ 설비장비
                     │
                 센서 + 통신
                     │
                 위험 감지 시
                 전원 즉시 차단
```

#### 제품 구성

```
┌──────────────────────────────────────────────────────────────────┐
│                      SafetyKit Box 외형                           │
│                                                                   │
│      ┌─────────┐                              ┌─────────┐        │
│      │  INPUT  │                              │ OUTPUT  │        │
│      │   🔌    │                              │   🔌    │        │
│      └────┬────┘                              └────┬────┘        │
│           │      ┌──────────────────────┐         │              │
│           └─────→│                      │←────────┘              │
│                  │    SafetyKit Pro     │                        │
│                  │                      │                        │
│                  │  ┌────┐    ┌────┐   │                        │
│                  │  │WiFi│    │센서│   │                        │
│                  │  └────┘    └────┘   │                        │
│                  │                      │                        │
│                  │  🔴 긴급정지 버튼     │                        │
│                  │                      │                        │
│                  │  💡 상태 LED         │                        │
│                  │   • 🟢 정상          │                        │
│                  │   • 🟡 경고          │                        │
│                  │   • 🔴 차단중        │                        │
│                  │                      │                        │
│                  └──────────────────────┘                        │
│                                                                   │
│                  설치: 30초 (플러그 뽑고 → 끼우고 → 꽂기)           │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

#### 제품 라인업

| 모델 | 사양 | 가격 | 용도 |
|------|------|------|------|
| **SafetyKit Lite** | 단상 220V/16A, WiFi | 8만원 | 소형 기계, 공작실 |
| **SafetyKit Pro** | 삼상 380V/32A, WiFi+LoRa+4G | 25만원 | 공장 설비 |
| **SafetyKit Industrial** | 삼상 380V/63A+, 이중화 통신 | 50만원 | 대형 프레스, 컨베이어 |

#### 내부 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                    SafetyKit 내부 회로                           │
│                                                                  │
│   INPUT ──┬─────────────────────────────────────┬── OUTPUT      │
│    (L)    │                                     │    (L)        │
│           │    ┌─────────────────────────┐      │               │
│           └───→│  SSR (Solid State Relay)│──────┘               │
│                │     무접점 릴레이 40A    │                       │
│                └───────────┬─────────────┘                       │
│                            │ 제어신호                             │
│                ┌───────────┴───────────┐                        │
│                │      MCU (ESP32)      │                        │
│                │  • 센서 입력           │                        │
│                │  • 네트워크 통신        │                        │
│                │  • 로컬 판단 로직       │                        │
│                └───────────┬───────────┘                        │
│         ┌──────────────────┼──────────────────┐                 │
│     ┌───┴───┐         ┌───┴───┐         ┌───┴───┐             │
│     │ 모션   │         │ 거리   │         │ 전류   │             │
│     │ 센서   │         │ 센서   │         │ 센서   │             │
│     └───────┘         └───────┘         └───────┘             │
└─────────────────────────────────────────────────────────────────┘
```

#### BOM (Bill of Materials)

| 부품 | 단가 |
|------|------|
| ESP32 모듈 | 8,000원 |
| SSR 40A (Solid State Relay) | 15,000원 |
| 전류 센서 (CT) | 5,000원 |
| PIR 모션 센서 | 3,000원 |
| 초음파 거리 센서 | 5,000원 |
| 전원부 (AC-DC 5V) | 5,000원 |
| 케이스 (IP65 방진방수) | 15,000원 |
| 커넥터, PCB, 기타 | 10,000원 |
| **원가 합계** | **약 66,000원** |
| **판매가** | **약 200,000원** |

---

### 2. LifeGuard Band (작업자용 생체 모니터링)

두 지점(팔, 다리)에서 생체 신호를 측정하여 **이상 징후를 조기 감지**하고 **자동 긴급 신고**합니다.

#### 핵심 원리: Pulse Transit Time (PTT)

```
┌─────────────────────────────────────────────────────────────────┐
│                 맥파 전달 시간 (PTT) 분석                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   심장 박동 → 팔에 도달 → 다리에 도달                              │
│                                                                  │
│   정상:   ❤️ ──0.1초──→ 💪 ──0.15초──→ 🦵                        │
│           (일정한 간격)                                           │
│                                                                  │
│   이상:   ❤️ ──0.1초──→ 💪 ──0.4초──→ 🦵  ⚠️ 지연!              │
│           (혈류 문제 의심)                                        │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   감지 가능한 이상 징후:                                          │
│   • 혈전 (DVT) - 다리 신호 지연/약화                              │
│   • 말초동맥질환 - 신호 전달 이상                                  │
│   • 부정맥 - 두 지점 리듬 불일치                                   │
│   • 혈압 급변 - PTT 변화로 추정                                   │
│   • 쇼크/실신 전조 - 말초 혈류 감소                                │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 제품 구성

```
┌─────────────────────────────────────────────────────────────────┐
│                    LifeGuard Band 시스템                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌──────────────────┐            ┌──────────────────┐         │
│   │    Band A (팔)    │            │    Band B (다리)  │         │
│   │    ──────────    │            │    ───────────   │         │
│   │                  │            │                  │         │
│   │  • PPG 센서      │◄──BLE────►│  • PPG 센서      │         │
│   │    (광학 심박)    │            │    (광학 심박)    │         │
│   │                  │            │                  │         │
│   │  • 가속도계      │            │  • 가속도계      │         │
│   │    (낙상 감지)    │            │    (움직임)      │         │
│   │                  │            │                  │         │
│   │  • 온도 센서     │            │  • 온도 센서     │         │
│   │                  │            │                  │         │
│   │  • SOS 버튼     │            │                  │         │
│   │                  │            │                  │         │
│   └────────┬─────────┘            └────────┬─────────┘         │
│            │                               │                    │
│            └───────────┬───────────────────┘                    │
│                        │                                        │
│                        ▼                                        │
│             ┌─────────────────────┐                             │
│             │    스마트폰 App      │                             │
│             │   ───────────────   │                             │
│             │   • 실시간 모니터링  │                             │
│             │   • AI 이상 감지    │                             │
│             │   • 긴급 신고 연동  │                             │
│             └─────────────────────┘                             │
│                        │                                        │
│                        ▼ 이상 시                                 │
│             ┌─────────────────────┐                             │
│             │  🚨 119 자동 신고   │                             │
│             │  📍 GPS 위치 전송   │                             │
│             │  👨‍👩‍👧 보호자 알림    │                             │
│             └─────────────────────┘                             │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 긴급 신고 플로우

```
┌─────────────────────────────────────────────────────────────────┐
│                      Emergency Flow                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   이상 감지              1차 확인               긴급 대응         │
│   ─────────             ─────────             ─────────         │
│                                                                  │
│   Band 이상 신호         10초 카운트다운        자동 신고          │
│        │                      │                    │            │
│        ▼                      ▼                    ▼            │
│   ┌─────────┐          ┌─────────────┐      ┌──────────┐       │
│   │ AI 분석  │──위험──→│ 📱 알림     │─무응답→│ 🚨 119   │       │
│   └─────────┘          │ "괜찮으세요?" │      │ 자동 신고 │       │
│                        │             │      └──────────┘       │
│                        │ [괜찮아요]   │            │            │
│                        │ [도움필요]   │            ▼            │
│                        └──────┬──────┘      ┌──────────┐       │
│                               │             │ 📍 위치   │       │
│                         "괜찮아요"           │ 📊 바이탈 │       │
│                           클릭 시           │ 👤 신원   │       │
│                               │             │    전송   │       │
│                               ▼             └──────────┘       │
│                          경고 해제               │              │
│                          (기록 저장)              ▼              │
│                                          ┌──────────────┐      │
│                                          │ 👨‍👩‍👧 보호자 알림 │      │
│                                          │ 📍 위치 공유   │      │
│                                          └──────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### BOM (Band 1개)

| 부품 | 단가 |
|------|------|
| nRF52840 (BLE SoC) | 8,000원 |
| MAX30102 (PPG 심박센서) | 5,000원 |
| MPU6050 (가속도/자이로) | 3,000원 |
| 온도 센서 | 1,000원 |
| 배터리 (200mAh) | 5,000원 |
| 밴드 (실리콘, 통기성) | 3,000원 |
| PCB, 케이스, 기타 | 5,000원 |
| **Band 1개 원가** | **약 30,000원** |
| **세트 (2개) 원가** | **약 60,000원** |
| **판매가 (세트)** | **약 150,000~200,000원** |

#### 타겟 사용자

| 대상 | 니즈 | 가치 |
|------|------|------|
| 👴 **독거 노인** | 혼자 쓰러져도 발견 안 됨 | 자동 감지 + 신고 |
| 🏭 **산업 현장 근로자** | 고온/위험 환경 작업 | 열사병, 실신 조기 감지 |
| 🏃 **마라톤/등산객** | 무리한 운동 중 위험 | 심장마비 조기 경고 |
| ❤️ **심장/뇌졸중 고위험군** | 24시간 모니터링 필요 | 골든타임 확보 |

---

### 3. Robot Control Simulator (로봇 관제 시뮬레이터)

실제 로봇 없이 **수만 대 규모의 가상 로봇**을 시뮬레이션하여 관제 시스템을 검증합니다.

#### 목적

- 실제 로봇 구매 없이 대규모 부하 테스트
- 다양한 장애 시나리오 검증 (카오스 엔지니어링)
- 분배 알고리즘 최적화
- 클린 아키텍처 강제 (시뮬레이터와 실제 로봇이 같은 인터페이스 사용)

#### 구성도

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Simulation Engine                                 │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                    Virtual World                                 │    │
│  │                                                                  │    │
│  │   ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐                      │    │
│  │   │ 🤖  │ │ 🤖  │ │ 🤖  │ │ 🤖  │ │ 🤖  │  × 10,000           │    │
│  │   └──┬──┘ └──┬──┘ └──┬──┘ └──┬──┘ └──┬──┘                      │    │
│  │      │       │       │       │       │                          │    │
│  │   ┌──┴───────┴───────┴───────┴───────┴──┐                      │    │
│  │   │         Virtual Environment          │                      │    │
│  │   │  🏭 창고  🔋 충전소  🚧 장애물  📍 목적지  │                      │    │
│  │   └─────────────────────────────────────┘                      │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                              │ Events                                    │
└──────────────────────────────┼──────────────────────────────────────────┘
                               ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                      Robot Control Backend                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                   │
│  │ Event Ingress │  │ Command Proc │  │ Task Dispatch │                   │
│  └──────────────┘  └──────────────┘  └──────────────┘                   │
└──────────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                      Monitoring Dashboard                                │
│  ┌────────────────────────────────────────────────────────────────┐     │
│  │  📊 실시간 메트릭  |  🗺️ 로봇 위치 맵  |  📈 이벤트 스트림       │     │
│  └────────────────────────────────────────────────────────────────┘     │
└──────────────────────────────────────────────────────────────────────────┘
```

#### Port & Adapter 패턴

시뮬레이터와 실제 로봇이 **같은 인터페이스**를 사용하므로, 어댑터만 교체하면 됩니다.

```
                    ┌─────────────────────────┐
                    │     Control System      │
                    │        (Core)           │
                    │                         │
                    │   ┌─────────────────┐   │
                    │   │  RobotPort      │   │  ← 인터페이스만 정의
                    │   │  (interface)    │   │
                    │   └────────┬────────┘   │
                    │            │            │
                    └────────────┼────────────┘
                                 │
                 ┌───────────────┼───────────────┐
                 │               │               │
                 ▼               ▼               ▼
          ┌──────────┐   ┌──────────┐   ┌──────────┐
          │Simulator │   │   MQTT   │   │   gRPC   │
          │ Adapter  │   │ Adapter  │   │ Adapter  │
          └──────────┘   └──────────┘   └──────────┘
               │               │               │
               ▼               ▼               ▼
           가상로봇        실제로봇A       실제로봇B
```

```bash
# 프로파일로 스위칭
./gradlew bootRun -Dspring.profiles.active=simulation   # 개발
./gradlew bootRun -Dspring.profiles.active=production   # 운영
```

#### 카오스 시나리오

| 시나리오 | 설명 | 검증 항목 |
|----------|------|----------|
| `MASS_FAILURE` | 30% 로봇 동시 고장 | 장애 복구, 작업 재분배 |
| `NETWORK_PARTITION` | 특정 구역 통신 두절 | 로컬 자율 동작 |
| `TRAFFIC_SPIKE` | 대량 작업 동시 생성 | 큐 처리량, 응답시간 |
| `CHARGING_STATION_FAILURE` | 충전소 고장 | 대체 경로 탐색 |

---

## 🔗 통합 시나리오

SafetyKit + LifeGuard + 관제 시스템이 연동되면:

```
┌─────────────────────────────────────────────────────────────────┐
│              산업현장 통합 안전 시나리오                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│                     정상 작업 중                                  │
│                         │                                        │
│                         ▼                                        │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                                                          │   │
│   │    👷 작업자 (LifeGuard 착용)                             │   │
│   │                                                          │   │
│   │    ⚙️ 설비 (SafetyKit 연결)                               │   │
│   │                                                          │   │
│   └─────────────────────────────────────────────────────────┘   │
│                         │                                        │
│                    작업자 쓰러짐                                  │
│                         │                                        │
│         ┌───────────────┴───────────────┐                       │
│         ▼                               ▼                        │
│   ┌───────────┐                   ┌───────────┐                 │
│   │ LifeGuard │                   │ SafetyKit │                 │
│   │ 이상 감지  │                   │           │                 │
│   └─────┬─────┘                   └─────┬─────┘                 │
│         │                               │                        │
│         │         ┌─────────┐           │                        │
│         └────────→│ SafetyHub│←──────────┘                        │
│                   │  Server  │                                   │
│                   └────┬────┘                                    │
│                        │                                         │
│         ┌──────────────┼──────────────┐                         │
│         ▼              ▼              ▼                          │
│   ┌──────────┐  ┌──────────┐  ┌──────────┐                      │
│   │ 해당 구역 │  │ 🚨 119  │  │ 👨‍👩‍👧 보호자│                      │
│   │ 설비 정지 │  │ 자동신고 │  │   알림   │                      │
│   └──────────┘  └──────────┘  └──────────┘                      │
│                                                                  │
│   ⏱️ 감지부터 대응까지: < 10초                                    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🛠️ 기술 스택

### Backend

| 영역 | 기술 | 선택 이유 |
|------|------|----------|
| Framework | Spring Boot 3.x + WebFlux | 비동기 처리, 고성능 |
| Language | Java 21 (Virtual Threads) | 대량 동시 연결 처리 |
| 실시간 통신 | Netty + MQTT (HiveMQ) | IoT 장치 연결 |
| 메시징 | Apache Kafka | 이벤트 소싱, 높은 TPS |
| 캐시 | Redis Cluster | 상태 실시간 조회 |
| DB | MySQL 8.x | 메인 데이터 저장 |
| 빌드 | Gradle 8.x (Groovy DSL) | 멀티모듈 빌드 |

### Frontend

| 영역 | 기술 |
|------|------|
| Framework | React 18 + TypeScript |
| 상태관리 | Zustand |
| 실시간 | WebSocket (STOMP) |
| 시각화 | D3.js, Recharts |
| 지도 | Leaflet / Mapbox |

### Hardware (SafetyKit)

| 영역 | 기술 |
|------|------|
| MCU | ESP32-WROOM-32 |
| 릴레이 | SSR (Solid State Relay) 40A |
| 통신 | WiFi, LoRa, 4G (옵션) |
| 센서 | PIR, 초음파, CT (전류) |

### Hardware (LifeGuard)

| 영역 | 기술 |
|------|------|
| MCU | nRF52840 (BLE 5.0) |
| 심박 | MAX30102 (PPG) |
| 모션 | MPU6050 (6축) |
| 배터리 | Li-Po 200mAh |

---

## 📁 프로젝트 구조

```
safetyhub/
│
├── docs/                           # 문서
│   ├── architecture/               # 아키텍처 설계
│   ├── api/                        # API 명세
│   └── hardware/                   # 하드웨어 회로도
│
├── backend/
│   ├── safetyhub-core/             # 도메인 모델, 이벤트
│   ├── safetyhub-gateway/          # 통합 게이트웨이
│   ├── safetyhub-application/      # UseCase 구현
│   │   ├── device-control/         # 설비 제어
│   │   ├── worker-monitoring/      # 작업자 모니터링
│   │   └── emergency-response/     # 긴급 대응
│   ├── safetyhub-adapter/
│   │   ├── adapter-mqtt/           # MQTT 어댑터
│   │   ├── adapter-websocket/      # WebSocket 어댑터
│   │   ├── adapter-rest/           # REST API
│   │   └── adapter-simulator/      # 시뮬레이터 어댑터
│   ├── safetyhub-infrastructure/
│   │   ├── persistence/            # JPA, Redis
│   │   ├── messaging/              # Kafka
│   │   └── external/               # 119 API, SMS 등
│   └── safetyhub-bootstrap/        # 실행 애플리케이션
│
├── frontend/
│   ├── dashboard/                  # 관제 대시보드
│   └── mobile-app/                 # React Native 앱
│
├── simulator/
│   ├── robot-simulator/            # 로봇 시뮬레이터
│   ├── device-simulator/           # SafetyKit 시뮬레이터
│   └── worker-simulator/           # LifeGuard 시뮬레이터
│
├── hardware/
│   ├── safetykit/
│   │   ├── firmware/               # ESP32 펌웨어
│   │   ├── pcb/                    # PCB 설계 (KiCad)
│   │   └── case/                   # 케이스 설계 (3D)
│   └── lifeguard/
│       ├── firmware/               # nRF52 펌웨어
│       └── pcb/                    # PCB 설계
│
├── infra/
│   ├── docker/                     # Docker 설정
│   ├── k8s/                        # Kubernetes 배포
│   └── terraform/                  # 클라우드 인프라
│
└── docker-compose.yml              # 로컬 개발 환경
```

---

## 🚀 빠른 시작

### 사전 요구사항

- Java 21+
- Docker & Docker Compose
- Gradle 8.x (또는 프로젝트 내 gradlew 사용)

### 로컬 개발 환경 실행

```bash
# 1. 인프라 서비스 실행 (MySQL, Redis, Kafka, HiveMQ)
docker-compose up -d

# 2. 인프라 상태 확인
docker-compose ps

# 3. 애플리케이션 빌드 및 실행
cd backend
./gradlew :safetyhub-bootstrap:bootRun

# 4. (선택) 모니터링 서비스 추가 실행
docker-compose --profile monitoring up -d
```

### 접속 정보

| 서비스 | URL | 비고 |
|--------|-----|------|
| 애플리케이션 | http://localhost:8080 | REST API |
| HiveMQ (MQTT) | tcp://localhost:1883 | IoT 장치 연결 |
| HiveMQ Console | http://localhost:8083 | MQTT 모니터링 |
| Grafana | http://localhost:3000 | 모니터링 대시보드 (admin/admin123) |

---

## 🗓️ 개발 로드맵

### Phase 1: Foundation (4주) ✅ 완료

```
Week 1-2: Core Infrastructure
├── [x] 프로젝트 스캐폴딩 (Gradle 멀티모듈)
├── [x] 클린 아키텍처 기본 구조
├── [x] Port/Adapter 인터페이스 정의
├── [x] Docker 개발 환경 구성
└── [ ] CI/CD 파이프라인

Week 3-4: Simulator MVP
├── [ ] Virtual Robot 구현
├── [ ] Virtual World (그리드 맵)
├── [ ] 기본 이벤트 발생
├── [x] WebSocket 실시간 통신 (설정 완료)
└── [ ] 간단한 대시보드 (위치 표시)
```

### Phase 2: Control System (4주)

```
Week 5-6: Command Processing
├── [ ] Unified Gateway 구현
├── [ ] 이벤트 수집 파이프라인
├── [ ] Hot/Warm/Cold Path 분리
├── [ ] Redis 상태 캐시
└── [ ] Kafka 이벤트 스트림

Week 7-8: Task Dispatch
├── [ ] 분배 알고리즘 구현
├── [ ] 경로 계획 (A* 등)
├── [ ] 충전 스케줄링
├── [ ] 카오스 시나리오 테스트
└── [ ] 성능 측정/튜닝
```

### Phase 3: SafetyKit (4주)

```
Week 9-10: Hardware Prototype
├── [ ] ESP32 + SSR 회로 구성
├── [ ] 기본 펌웨어 (릴레이 제어)
├── [ ] MQTT 통신 구현
├── [ ] 센서 연동 (PIR, 초음파)
└── [ ] 3D 프린팅 케이스

Week 11-12: Integration
├── [ ] SafetyHub 서버 연동
├── [ ] 원격 제어 기능
├── [ ] 로컬 자율 판단 로직
├── [ ] 시뮬레이터 어댑터
└── [ ] E2E 테스트
```

### Phase 4: LifeGuard (4주)

```
Week 13-14: Hardware Prototype
├── [ ] nRF52840 + MAX30102 구성
├── [ ] BLE 통신 구현
├── [ ] PPG 신호 수집
├── [ ] 가속도계 낙상 감지
└── [ ] 배터리/충전 회로

Week 15-16: Analytics & Alert
├── [ ] PTT 계산 알고리즘
├── [ ] 이상 감지 AI 모델
├── [ ] 스마트폰 앱 (React Native)
├── [ ] 119 자동 신고 연동
└── [ ] 보호자 알림 시스템
```

### Phase 5: Integration & Polish (4주)

```
Week 17-18: Full Integration
├── [ ] SafetyKit + LifeGuard 연동
├── [ ] 통합 대시보드
├── [ ] 다중 현장 관리
└── [ ] 알림/리포팅 시스템

Week 19-20: Production Ready
├── [ ] 부하 테스트 (10,000+ 장치)
├── [ ] 보안 강화 (인증, 암호화)
├── [ ] 문서화
├── [ ] 데모 시나리오 준비
└── [ ] 인증 준비 (KC 등)
```

---

## 🤖 로봇 시뮬레이션 시스템

실제 작업자 투입 전, **로봇 더미(Robot Worker)** 를 활용하여 대규모 산업 현장 환경을 시뮬레이션합니다.

### 시뮬레이션 목표

```
┌─────────────────────────────────────────────────────────────────┐
│                    Virtual Factory Simulation                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐           │
│   │ Zone A  │  │ Zone B  │  │ Zone C  │  │ Zone D  │           │
│   │ 작업장  │  │ 작업장  │  │ 위험구역│  │ 창고    │           │
│   │ 🤖🤖🤖 │  │ 🤖🤖   │  │ ⚠️🤖   │  │ 🤖     │           │
│   └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘           │
│        └────────────┴────────────┴────────────┘                 │
│                      Main Corridor                               │
│        ┌────────────┬────────────┬────────────┐                 │
│   ┌────┴────┐  ┌────┴────┐  ┌────┴────┐  ┌────┴────┐           │
│   │ 휴게실  │  │ 식당    │  │ 의무실  │  │ 대피소  │           │
│   │ 🤖🤖   │  │ 🤖🤖🤖 │  │ 🏥     │  │ 🚨      │           │
│   └─────────┘  └─────────┘  └─────────┘  └─────────┘           │
│                                                                   │
│   🤖 Robot Worker (로봇 더미)   ⚠️ 위험 감지   🚨 긴급 상황     │
└─────────────────────────────────────────────────────────────────┘
```

### 로봇 행동 시뮬레이션

| 행동 | 설명 | 시간대 |
|------|------|--------|
| 💼 **작업 (WORKING)** | 할당 구역에서 작업 수행 | 08:00-10:00, 10:15-12:00, ... |
| ☕ **휴식 (RESTING)** | 휴게실로 이동 후 대기 | 10:00-10:15, 15:00-15:15 |
| 🍽️ **식사 (EATING)** | 식당으로 이동 후 대기 | 12:00-13:00 |
| 🚶 **이동 (MOVING)** | A* 알고리즘 경로 이동 | 구역 전환 시 |
| 🚨 **긴급 (EMERGENCY)** | SOS, 낙상, 건강 이상 | 랜덤/시나리오 |

### 테스트 시나리오

| 시나리오 | 설명 | 검증 항목 |
|----------|------|----------|
| **일상 운영** | 500대 로봇 8시간 정규 운영 | 위치 추적, 하트비트 안정성 |
| **화재 발생** | Zone C 화재 감지 → 대피 | 알림 < 3초, 대피 < 10분 |
| **작업자 낙상** | 가속도계 급변 → 긴급 대응 | 감지 < 1초, 알림 < 3초 |
| **가스 누출** | 가스 센서 임계치 → 설비 차단 | 차단 < 100ms (Hot Path) |
| **부하 테스트** | 10,000대 동시 접속 | 응답 < 100ms, 손실 0% |

> 📄 상세 문서: [docs/ROBOT_SIMULATION.md](docs/ROBOT_SIMULATION.md)

---

## 💡 추가 아이디어

### 1. 환경 센서 확장

SafetyKit에 환경 센서를 추가하여 **작업 환경 모니터링**:

```
┌─────────────────────────────────────────────────────────┐
│                 SafetyKit Pro+                          │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  기존 기능 + 환경 센서:                                   │
│                                                          │
│  🌡️ 온습도 - 열사병 위험 경고                             │
│  💨 가스 감지 - CO, 유해가스 누출                         │
│  🔊 소음 측정 - 청력 보호 알림                            │
│  💡 조도 측정 - 작업 환경 적정성                          │
│  📳 진동 측정 - 기계 이상 조기 감지                        │
│                                                          │
│  → LifeGuard와 연동 시:                                  │
│     "고온 환경 + 작업자 심박 상승" = 열사병 위험 경고       │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### 2. AI 예측 유지보수

센서 데이터로 **기계 고장을 예측**:

```
┌─────────────────────────────────────────────────────────┐
│              Predictive Maintenance                      │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  SafetyKit 수집 데이터:                                   │
│  • 전류 패턴                                              │
│  • 진동 패턴                                              │
│  • 가동 시간                                              │
│  • 온도 변화                                              │
│                                                          │
│           ↓ AI 분석                                      │
│                                                          │
│  "이 모터는 72시간 내 고장 확률 85%"                       │
│  "베어링 마모 의심, 점검 권장"                             │
│                                                          │
│           ↓ 자동 조치                                     │
│                                                          │
│  • 정비팀 알림                                            │
│  • 예비 부품 자동 발주                                    │
│  • 작업 스케줄 자동 조정                                  │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### 3. 음성 인터페이스

작업자가 **손을 쓰지 않고** 시스템과 소통:

```
작업자: "클로드, A3 설비 정지해줘"
시스템: "A3 프레스기 정지합니다. 정지 사유를 말씀해주세요."
작업자: "금형 점검"
시스템: "A3 프레스기, 금형 점검으로 정지 기록했습니다."
```

### 4. AR 안전 가이드

스마트글래스로 **실시간 안전 정보 표시**:

```
┌─────────────────────────────────────────────────────────┐
│              AR Safety Overlay                           │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  작업자 시야:                                             │
│                                                          │
│  ┌───────────────────────────────────────────────────┐  │
│  │                                                    │  │
│  │    ⚠️ 고온 구역 (150°C)                            │  │
│  │    ──────────────────                             │  │
│  │         │                                         │  │
│  │         ▼                                         │  │
│  │    ┌─────────┐                                   │  │
│  │    │  설비A   │ ← 🔴 작동 중                      │  │
│  │    │         │   💡 정비 예정 D-3                 │  │
│  │    └─────────┘                                   │  │
│  │                                                    │  │
│  │    👷 동료 위치: 10m 후방                          │  │
│  │                                                    │  │
│  └───────────────────────────────────────────────────┘  │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### 5. 블록체인 안전 인증

**안전 기록의 위변조 방지**:

```
┌─────────────────────────────────────────────────────────┐
│            Safety Compliance Blockchain                  │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  기록되는 데이터:                                         │
│  • 설비 점검 이력                                         │
│  • 작업자 안전교육 이수                                   │
│  • 사고/아차사고 기록                                     │
│  • SafetyKit 설치/점검 이력                              │
│                                                          │
│  활용:                                                   │
│  • 산업안전보건법 감사 대응                               │
│  • 보험 심사 자동화                                       │
│  • ESG 보고서 자동 생성                                   │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### 6. 게이미피케이션 안전 관리

**안전을 게임처럼** 만들어 참여 유도:

```
┌─────────────────────────────────────────────────────────┐
│            Safety Gamification                           │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  👷 김철수 작업자                                         │
│                                                          │
│  🏆 이번 달 안전 점수: 950점                              │
│                                                          │
│  📊 달성 현황:                                            │
│  ✅ 무사고 연속 30일 (+100점)                             │
│  ✅ LifeGuard 매일 착용 (+50점)                          │
│  ✅ 안전 퀴즈 만점 (+30점)                                │
│  ⚠️ 안전구역 이탈 1회 (-20점)                             │
│                                                          │
│  🎁 보상:                                                 │
│  • 1,000점: 커피 쿠폰                                     │
│  • 3,000점: 반차 사용권                                   │
│  • 10,000점: 포상 휴가                                    │
│                                                          │
│  🏅 팀 순위: A조 1위 / 전체 3위                           │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### 7. 디지털 트윈

**현장을 3D로 실시간 복제**:

```
┌─────────────────────────────────────────────────────────┐
│                Digital Twin Factory                      │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  실제 현장              ←→         디지털 트윈            │
│                                                          │
│  ┌─────────┐                    ┌─────────┐            │
│  │ 🏭      │     실시간 동기화   │ 🖥️      │            │
│  │ 공장    │  ◄──────────────►  │ 3D 모델 │            │
│  └─────────┘                    └─────────┘            │
│                                                          │
│  활용:                                                   │
│  • 원격 현장 모니터링                                     │
│  • 시뮬레이션 (레이아웃 변경 전 테스트)                    │
│  • 신입 교육 (VR 체험)                                   │
│  • 사고 재현/분석                                        │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 💰 비용 분석

### 기존 방식 vs SafetyHub

```
┌─────────────────────────────────────────────────────────────────┐
│                    비용 비교 (100대 설비 기준)                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  기존: 설비 전체 교체                                            │
│  ────────────────────                                            │
│  • 설비 교체: 50억원+                                            │
│  • 설치 기간: 6개월+                                             │
│  • 생산 중단: 수억원 손실                                         │
│                                                                  │
│  SafetyHub: 레트로핏                                             │
│  ─────────────────────                                           │
│  • SafetyKit 100대: 2,000만원                                    │
│  • 서버/인프라: 500만원                                          │
│  • 설치: 1주일 (무중단)                                          │
│  • 월 운영비: 500만원 (SaaS)                                     │
│                                                                  │
│  절감 효과: 약 95%                                               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### ROI 시나리오

```
산업재해 1건 평균 비용: 약 1.5억원
(치료비 + 보상금 + 생산차질 + 벌금 등)

SafetyHub 도입 비용: 약 3,000만원 (100대 기준)

→ 연간 사고 1건만 예방해도 5배 ROI
```

---

## 📜 인증/규격

### 필수 인증

| 인증 | 대상 | 비용 | 기간 |
|------|------|------|------|
| KC 인증 | SafetyKit | 2,000만원 | 3개월 |
| CE 마킹 | SafetyKit (수출) | 1,500만원 | 2개월 |
| 의료기기 인허가 | LifeGuard (선택) | 5,000만원+ | 12개월+ |
| 산업안전보건법 적합 | 전체 | 500만원 | 1개월 |

### 참고 규격

- IEC 61508 (기능안전)
- ISO 13849 (기계류 안전)
- IEC 62443 (산업 사이버보안)

---

## 🤝 협업 및 기여

### 기여 방법

1. Fork & Clone
2. Feature Branch 생성
3. 변경사항 커밋
4. Pull Request 생성

### 코드 컨벤션

- Java: Google Java Style Guide
- TypeScript: ESLint + Prettier
- 커밋: Conventional Commits

---

## 📞 연락처

- 프로젝트 관리자: [이름]
- 이메일: [이메일]
- 기술 문의: GitHub Issues

---

## 📄 라이선스

MIT License

---

*"모든 작업자가 안전하게 집으로 돌아갈 수 있도록"*
